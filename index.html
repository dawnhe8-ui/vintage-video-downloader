<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å»æ°´å°ä¸‹è½½å·¥å…·</title>
  <style>
    :root{--bg:#2a1810;--panel:#3d2817;--text:#f4f1eb;--muted:#c4a882;--primary:#d4a574;--danger:#c85a54;--ok:#7a9471;--border:#5a4332}
    *{box-sizing:border-box}
    body{margin:0;font-family:Georgia,"Times New Roman",serif;line-height:1.6;background:linear-gradient(180deg,#2a1810,#3d2817 25%,#2a1810);color:var(--text);background-attachment:fixed}
    header{padding:32px 16px;text-align:center;border-bottom:3px double var(--border)}
    header h1{margin:0;font-size:32px;letter-spacing:2px;text-shadow:2px 2px 4px rgba(0,0,0,.5);font-weight:bold}
    .container{max-width:800px;margin:0 auto;padding:0 16px 48px}
    .card{background:var(--panel);border:2px solid var(--border);border-radius:8px;padding:24px;box-shadow:0 8px 24px rgba(0,0,0,.4);margin-bottom:24px}
    .section{margin-bottom:20px}
    .section-header{font-size:18px;color:var(--primary);margin-bottom:12px;border-bottom:1px solid var(--border);padding-bottom:6px;font-weight:bold}
    label{display:block;margin:8px 0 10px;color:var(--muted);font-weight:500}
    textarea,input{width:100%;border-radius:6px;border:2px solid var(--border);background:#1a0f08;color:var(--text);padding:14px 16px;font-family:inherit}
    textarea{min-height:140px;resize:vertical}
    .btn{appearance:none;border:2px solid var(--primary);border-radius:6px;padding:12px 20px;background:var(--primary);color:#1a0f08;cursor:pointer;font-weight:bold;transition:.2s all ease;box-shadow:0 4px 12px rgba(0,0,0,.3);font-family:inherit}
    .btn.secondary{background:transparent;color:var(--primary);border-color:var(--primary)}
    .btn.danger{background:var(--danger);border-color:var(--danger);color:#fff}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .help{color:var(--muted);font-size:13px}
    .result{margin-top:16px;padding-top:12px;border-top:1px dashed var(--border)}
    .field{margin:10px 0}
    .value{word-break:break-all;background:#1a0f08;border:2px inset var(--border);padding:12px 14px;border-radius:4px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,\"Liberation Mono\",\"Courier New\",monospace;font-size:14px}
    .preview{margin-top:10px}
    img.cover{max-width:100%;border-radius:12px;border:1px solid var(--border)}
    .badge{display:inline-block;padding:4px 12px;border-radius:4px;background:var(--danger);color:#fff;font-size:12px;margin-left:8px;border:1px solid var(--border)}
    .status{font-size:14px;color:var(--muted)}
    .footer{margin-top:32px;text-align:center;color:var(--muted);font-size:14px;border-top:1px solid var(--border);padding-top:20px;font-style:italic}

    /* Password gate */
    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(3,6,17,.85);backdrop-filter:blur(4px);z-index:50}
    .gate .box{width:min(92vw,420px);background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:20px}
    .gate h2{margin:4px 0 10px;font-size:18px}
    .hidden{display:none!important}
    .spinner{width:16px;height:16px;border:2px solid #94a3b8;border-top-color:#fff;border-radius:50%;display:inline-block;animation:spin 1s linear infinite;vertical-align:-3px}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Vintage Enhancements */
    .btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.4)}
    .btn.secondary:hover{background:var(--primary);color:#1a0f08}
    .btn.danger:hover{background:#d66660}
    textarea:focus,input:focus{outline:3px solid var(--primary);outline-offset:2px;box-shadow:0 0 8px rgba(212,165,116,.3)}
    .ornament{text-align:center;margin:20px 0;color:var(--border);font-size:20px}

  </style>
</head>
<body>
  <div id="gate" class="gate">
    <div class="box">
      <h2>è¯·è¾“å…¥è®¿é—®å¯†ç </h2>
      <div class="help">æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ äº¤æµï¼Œå¯†ç ä¸º 123456</div>
      <div style="margin-top:10px">
        <input id="pwd" type="password" placeholder="è¾“å…¥å¯†ç  123456" />
      </div>

        <label class="help" style="display:flex;align-items:center;gap:6px;margin-top:8px;cursor:pointer">
          <input id="showPwd" type="checkbox" style="accent-color:#3b82f6" /> æ˜¾ç¤ºå¯†ç 
        </label>

      <div class="actions" style="margin-top:12px">
        <button id="enterBtn" class="btn">è¿›å…¥</button>
      </div>
      <div id="gateMsg" class="help" style="margin-top:8px"></div>
    </div>
  </div>

  <header>
    <h1>å»æ°´å°ä¸‹è½½å·¥å…· <span class="badge">Beta</span></h1>
    <div class="help">ç²˜è´´åŒ…å«åˆ†äº«æ–‡æ¡ˆçš„æ–‡æœ¬ï¼Œè‡ªåŠ¨è¯†åˆ«é“¾æ¥å¹¶è§£æ</div>
  </header>

  <div class="container">
    <div class="card">
      <div class="section-header">ğŸ“ è¾“å…¥åˆ†äº«å†…å®¹</div>
      <div class="section">
        <label for="shareInput">åˆ†äº«æ–‡æ¡ˆ</label>
        <textarea id="shareInput" placeholder="åœ¨è¿™é‡Œç²˜è´´åŒ…å« http/https é“¾æ¥çš„åˆ†äº«å†…å®¹...&#10;ä¾‹å¦‚ï¼š4.89 03/24 ... https://v.douyin.com/ZOqdo9qsYuY/ å¤åˆ¶æ­¤é“¾æ¥..."></textarea>
        <div class="actions" style="margin-top:14px">
          <button id="extractBtn" class="btn secondary">ğŸ” æå–é“¾æ¥</button>
          <button id="parseBtn" class="btn">ğŸš€ å¼€å§‹è§£æ</button>
          <button id="clearBtn" class="btn danger">ğŸ§¹ æ¸…ç©º</button>
        </div>
        <div class="help" style="margin-top:10px">æ”¯æŒä»»æ„åŒ…å« http æˆ– https çš„æ–‡æœ¬ï¼Œè‡ªåŠ¨æå–é¦–ä¸ªé“¾æ¥</div>
      </div>
    </div>

    <div class="ornament">â¦ â¦ â¦</div>

    <div class="card">
      <div class="section-header">ğŸ”— è¯†åˆ«ç»“æœ</div>
      <div class="section">
        <label>è¯†åˆ«å‡ºçš„é“¾æ¥</label>
        <div id="urlBox" class="value">ï¼ˆå°šæœªè¯†åˆ«ï¼‰</div>
        <div class="actions" style="margin-top:14px">
          <button id="copyUrlBtn" class="btn secondary">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
          <a id="openUrlBtn" class="btn secondary" href="#" target="_blank" rel="noopener">ğŸ”— åœ¨æ–°æ ‡ç­¾æ‰“å¼€</a>
        </div>
        <div id="status" class="status" style="margin-top:12px"></div>
      </div>
    </div>

    <div id="result" class="card hidden">
      <div class="section-header">ğŸ¬ è§£æç»“æœ</div>
      <div class="section">
        <div class="field"><strong>æ ‡é¢˜ï¼š</strong><span id="title"></span></div>
        <div class="field"><strong>è§†é¢‘åœ°å€ï¼š</strong><span id="videoUrl" class="value"></span></div>
        <div class="field"><strong>å°é¢åœ°å€ï¼š</strong><span id="coverUrl" class="value"></span></div>
        <div class="actions" style="margin-top:16px">
          <button id="downloadVideoBtn" class="btn">â¬‡ï¸ ä¸‹è½½è§†é¢‘</button>
          <button id="downloadCoverBtn" class="btn secondary">ğŸ–¼ï¸ ä¸‹è½½å°é¢</button>
          <button id="copyVideoBtn" class="btn secondary">ğŸ”— å¤åˆ¶è§†é¢‘é“¾æ¥</button>
          <button id="copyCoverBtn" class="btn secondary">ğŸ”— å¤åˆ¶å°é¢é“¾æ¥</button>
        </div>
        <div class="preview" style="margin-top:16px">
          <label>å°é¢é¢„è§ˆ</label>
          <img id="coverImg" class="cover" alt="å°é¢é¢„è§ˆ" />
        </div>
      </div>
    </div>

    <div class="ornament">â¦ â¦ â¦</div>

    <div class="footer">
      <div>~ æç¤ºï¼šè‹¥æµè§ˆå™¨å› è·¨åŸŸé™åˆ¶å¯¼è‡´æ— æ³•ç›´æ¥ä¸‹è½½ï¼Œå°†å°è¯•åœ¨æ–°æ ‡ç­¾æ‰“å¼€èµ„æºåå¦å­˜ä¸º ~</div>
      <div style="margin-top:8px;font-size:12px">å¤å¤é£æ ¼å»æ°´å°å·¥å…· Â· ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨</div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://api.guijianpan.com/waterRemoveDetail/xxmQsyByAk?ak=cf8193d79225459ab7b01c56aef27b91&link=';
    const PASSWORD = '123456';

    const $ = (id)=>document.getElementById(id);
    const el = {
      gate: $('gate'), pwd: $('pwd'), showPwd: $('showPwd'), enterBtn: $('enterBtn'), gateMsg: $('gateMsg'),
      shareInput: $('shareInput'), extractBtn: $('extractBtn'), parseBtn: $('parseBtn'), clearBtn: $('clearBtn'),
      urlBox: $('urlBox'), copyUrlBtn: $('copyUrlBtn'), openUrlBtn: $('openUrlBtn'), status: $('status'),
      result: $('result'), title: $('title'), videoUrl: $('videoUrl'), coverUrl: $('coverUrl'), coverImg: $('coverImg'),
      downloadVideoBtn: $('downloadVideoBtn'), downloadCoverBtn: $('downloadCoverBtn'), copyVideoBtn: $('copyVideoBtn'), copyCoverBtn: $('copyCoverBtn')
    };

    // Password gate logic
      if(el.showPwd){ el.showPwd.addEventListener('change', ()=>{ el.pwd.type = el.showPwd.checked ? 'text' : 'password'; }); }

    (function initGate(){
      try{
        const ok = sessionStorage.getItem('gate-ok');
        if(ok==='1'){ el.gate.classList.add('hidden'); return; }
      }catch(e){}
      el.enterBtn.addEventListener('click', ()=>{
        const v = (el.pwd.value||'').trim();
        if(v===PASSWORD){
          try{ sessionStorage.setItem('gate-ok','1'); }catch(e){}
          el.gate.classList.add('hidden');
          setTimeout(()=>{ try{ el.shareInput && el.shareInput.focus(); }catch(_){} }, 50);
        }else{
          el.gateMsg.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
        }
      });
      el.pwd.addEventListener('keydown', (e)=>{ if(e.key==='Enter') el.enterBtn.click(); });
    })();

    function setStatus(msg, spinning=false){
      el.status.innerHTML = spinning ? `<span class="spinner"></span> ${msg}` : msg;
    }

    function extractFirstUrl(text){
      if(!text) return null;
      const regex = /(https?:\/\/[^\s"']+)/i;
      const m = text.match(regex);
      if(!m) return null;
      // trim trailing punctuation that sometimes sticks without whitespace
      let url = m[1].replace(/[)ï¼Œ)ã€‚ã€‘ã€‘\]\)>]+$/g, '');
      return url;
    }

    function showUrl(url){
      if(url){
        el.urlBox.textContent = url;
        el.openUrlBtn.href = url;
        el.copyUrlBtn.disabled = false;
      }else{
        el.urlBox.textContent = 'ï¼ˆå°šæœªè¯†åˆ«ï¼‰';
        el.openUrlBtn.href = '#';
        el.copyUrlBtn.disabled = true;
      }
    }

    function filenameFromUrl(u, fallback){
      try{
        const url = new URL(u);
        const path = url.pathname.split('/').filter(Boolean).pop()||'';
        const name = path.split('?')[0]||'';
        if(name) return name;
      }catch(e){}
      return fallback||'download';
    }

    async function downloadByFetch(u, suggestName){
      try{
        const resp = await fetch(u, {mode:'cors'});
        if(!resp.ok) throw new Error('HTTP '+resp.status);
        const blob = await resp.blob();
        const a = document.createElement('a');
        const url = URL.createObjectURL(blob);
        a.href = url;
        a.download = suggestName || filenameFromUrl(u, 'file');
        document.body.appendChild(a); a.click(); a.remove();
        setTimeout(()=>URL.revokeObjectURL(url), 5000);
        return true;
      }catch(err){
        console.warn('downloadByFetch failed:', err);
        return false;
      }
    }

    function fallbackOpen(u){
      window.open(u, '_blank', 'noopener');
    }

    async function copyText(t){
      try{ await navigator.clipboard.writeText(t); return true; }catch(e){
        // Fallback
        const ta=document.createElement('textarea'); ta.value=t; document.body.appendChild(ta); ta.select();
        try{ document.execCommand('copy'); }catch(_){}
        ta.remove(); return true;
      }
    }

    async function parseLink(link){
      const url = API_BASE + encodeURIComponent(link);
      setStatus('æ­£åœ¨è§£æï¼Œè¯·ç¨å€™...', true);
      try{
        const resp = await fetch(url);
        const data = await resp.json();
        if(!resp.ok || !data || data.code!=='10000' || !data.content || data.content.success!==true){
          throw new Error(data && data.msg ? data.msg : 'è§£æå¤±è´¥');
        }
        const { title, url:video, cover } = data.content;
        el.title.textContent = title || '(æ— æ ‡é¢˜)';
        el.videoUrl.textContent = video || '';
        el.coverUrl.textContent = cover || '';
        el.coverImg.src = cover || '';
        el.result.classList.remove('hidden');
        setStatus('è§£ææˆåŠŸ');
      }catch(e){
        console.error(e);
        setStatus('è§£æå¤±è´¥ï¼š' + (e.message || 'æœªçŸ¥é”™è¯¯'));
      }
    }

    // Bindings
    el.extractBtn.addEventListener('click', ()=>{
      const url = extractFirstUrl(el.shareInput.value);
      showUrl(url);
      setStatus(url? 'å·²è¯†åˆ«é“¾æ¥' : 'æœªè¯†åˆ«åˆ° http/https é“¾æ¥');
    });

    el.parseBtn.addEventListener('click', ()=>{
      let url = el.urlBox.textContent && el.urlBox.textContent.startsWith('http') ? el.urlBox.textContent : null;
      if(!url){ url = extractFirstUrl(el.shareInput.value); showUrl(url); }
      if(!url){ setStatus('è¯·å…ˆç²˜è´´åˆ†äº«å†…å®¹å¹¶æå–åˆ°é“¾æ¥'); return; }
      parseLink(url);
    });

    el.clearBtn.addEventListener('click', ()=>{
      el.shareInput.value=''; showUrl(null); el.result.classList.add('hidden'); setStatus('');
    });

    el.copyUrlBtn.addEventListener('click', async()=>{
      const u = el.urlBox.textContent; if(!u||!u.startsWith('http')) return;
      await copyText(u); setStatus('å·²å¤åˆ¶é“¾æ¥');
    });

    el.downloadVideoBtn.addEventListener('click', async()=>{
      const u = el.videoUrl.textContent; if(!u) return;
      const ok = await downloadByFetch(u, filenameFromUrl(u,'video.mp4'));
      if(!ok){ setStatus('ç›´æ¥ä¸‹è½½å—é™ï¼Œå·²åœ¨æ–°æ ‡ç­¾æ‰“å¼€'); fallbackOpen(u); }
    });

    el.downloadCoverBtn.addEventListener('click', async()=>{
      const u = el.coverUrl.textContent; if(!u) return;
      const ok = await downloadByFetch(u, filenameFromUrl(u,'cover.jpg'));
      if(!ok){ setStatus('ç›´æ¥ä¸‹è½½å—é™ï¼Œå·²åœ¨æ–°æ ‡ç­¾æ‰“å¼€'); fallbackOpen(u); }
    });

    el.copyVideoBtn.addEventListener('click', async()=>{
      const u = el.videoUrl.textContent; if(!u) return; await copyText(u); setStatus('å·²å¤åˆ¶è§†é¢‘é“¾æ¥');
    });
    el.copyCoverBtn.addEventListener('click', async()=>{
      const u = el.coverUrl.textContent; if(!u) return; await copyText(u); setStatus('å·²å¤åˆ¶å°é¢é“¾æ¥');
    });

    // Prefill example
    const example = '4.89 03/24 cNJ:/ K@W.md éšæ„â€œæ­è®ªâ€éŸ©å›½ç¾å¥³ï¼Œå°åº¦å¯ŒäººåŒºçš„ä¸‰å“¥èƒ½æœ‰å¤šè‡ªä¿¡ï¼Ÿ # å¤–å›½äºº # æ­ªæœä»çœŸä¼šç© # å°åº¦ # æ—…è¡Œ # çœ‹ä¸–ç•Œ  https://v.douyin.com/ZOqdo9qsYuY/ å¤åˆ¶æ­¤é“¾æ¥ï¼Œæ‰“å¼€DouéŸ³æœç´¢ï¼Œç›´æ¥è§‚çœ‹è§†é¢‘ï¼';
    el.shareInput.placeholder = example;
  </script>
</body>
</html>

